<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>G-CARD Directeor_v2.1</title>
<link rel="icon" type="image/png" href="./カードリスト/ファビコン.png" />
<link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="toolbar" class="hidden">

    <!-- 画像読み込みボタン削除（入力は保持） -->
    <input id="fileInput" type="file" accept="image/*" multiple>

    <!-- 裏面画像ボタン削除（入力は保持） -->
    <input id="backInput" type="file" accept="image/*">
    <button id="btnToolbarCollapse" type="button" aria-expanded="true" title="ツールバーを折りたたみ/展開">▾ ツールバー</button>
    <button id="btnFlip">選択→表裏反転</button>
    <button id="btnRemove" style="background:#8b0000;">消滅</button>
    <button id="btnToFront">最前面</button>
    <button id="btnToBack">最後面</button>
    <button id="btnUndo">↩︎Undo</button>
    <button id="btnSave">💾保存</button>
    <button id="btnLoad">📥読込</button>
    <button id="btnOpenSpectator" style="background:#2a8;">📺共有用(手札非表示)</button>
<button id="btnTurnStart" style="background:#0057b7;">ターンスタート</button>
    <button id="btnPreview">拡大表示</button>
    <button id="btnToken">トークン</button>
        <button id="btnCounter" title="カウンターを載せる（+1000/+3000/+5000/+10000）">➕カウンター</button>
<button id="btnCoin" title="コイントス（表/裏ランダム）">🪙コイントス</button>
<button id="btnCalc" title="簡単な計算機を開く/閉じる">🧮計算機</button>
    <button id="btnShortcuts" title="ショートカット一覧を表示">⌨️ショートカット</button>

    <label>戻す位置
      <select id="deckReturnPos">
        <option value="top">上</option>
        <option value="bottom">下</option>
      </select>
    </label>
<button id="btnSoloOverview" class="soloOnly" title="2人の盤面を縮小して同時に表示">🧩 2面表示</button>
<button id="btnBackToMode" style="background:#444a;">◀ モード選択に戻る</button>
  </div>

  <div id="spectatorBadge">共有用（手札 / サーチ非表示）</div>
  <div id="spectatorPickPanel" class="hidden">
    <img id="spectatorPickImg" alt="">
    <div>
      <div class="title">サーチ選択中</div>
      <div id="spectatorPickName" class="sub"></div>
    </div>
  </div>

  <div id="stageWrap"><div id="stage">
    <div id="board"></div>
    <div id="deckCounter"></div>
    <div id="discardCounter"></div>
    <div id="monsterCounter"></div>
  </div></div>

<!-- start modal -->
  <div id="startModal">
    <div id="startBox">
      <h1>G-CARD Director</h1>
      <button id="btnStartBuild">デッキ構築モード</button>
      <button id="btnStartPlay">プレイモード</button>
    </div>
  </div>

  <!-- deck builder -->
  <div id="builder" class="hidden">
    <div id="builderPanel">
      <h2>デッキ構築</h2>
      <div id="builderMain">
        <div id="mobileBuilderTabs" class="hidden" role="tablist" aria-label="表示切り替え">
          <button id="btnMobileShowLib" type="button" role="tab" aria-selected="true">カードリスト</button>
          <button id="btnMobileShowDeck" type="button" role="tab" aria-selected="false">現在のデッキ</button>
        </div>
        <div id="libPane">
          <h3>カード一覧</h3>

          <!-- set / pack filter (collapsible) -->
          <div id="libSetSection" class="setSection">
            <div id="libSetHeader" class="setHeader" role="button" tabindex="0" aria-controls="libSetBarWrap" aria-expanded="true">
              <div class="setHeaderLeft">
                <span class="setHeaderTitle">弾フィルタ</span>
                <span class="setHeaderCurrent" id="libSetCurrent">すべて</span>
              </div>
              <button id="btnLibSetToggle" type="button" class="setToggle" aria-label="弾フィルタを折りたたみ/展開">▾</button>
            </div>
            <div id="libSetBarWrap">
              <div id="libSetBar"></div>
            </div>
          </div>

          <input id="libFilter" placeholder="名前 / 特徴 / テキストで検索…" />
           <div id="libMetaBar">
             <select id="libColor"><option value="">色:すべて</option><option value="赤">赤</option><option value="青">青</option><option value="緑">緑</option><option value="白">白</option></select>
             <select id="libType"><option value="">種別:すべて</option><option value="怪獣">怪獣</option><option value="交戦">交戦</option><option value="戦略">戦略</option></select>
             <select id="libGrade"><option value="">等級:すべて</option></select>
           </div>
          <div id="libList"></div>
        </div>
        <div id="deckPane">
          <h3>現在のデッキ</h3>
          <div id="deckScroll">
            <div class="deckGroup" id="grpMonster"><h4>怪獣デッキ</h4><div class="deckGrid" id="gridMonster"></div></div>
            <div class="deckGroup" id="grpMain"><h4>メインデッキ</h4><div class="deckGrid" id="gridMain"></div></div>
          </div>
        </div>
      </div>
      <div id="builderFooter" class="builderFooterSection">
        <div id="builderFooterHeader" class="builderFooterHeader" role="button" tabindex="0" aria-controls="builderFooterBody" aria-expanded="true">
          <div id="countInfo">メイン 0/50　怪獣 0/4</div>
          <button id="btnBuilderFooterToggle" type="button" class="builderFooterToggle" aria-label="デッキ構築の下部メニューを折りたたみ/展開">▾</button>
        </div>
        <div id="builderFooterBody">
          <textarea id="deckCodeBox" placeholder="ここにデッキコードを貼る / 生成されたコードが出る"></textarea>
          <div class="builderBtnCol">
            <button id="btnCodeLoad">コード読込</button>
            <button id="btnCodeGen">コード生成</button>
            <button id="btnQrGen" title="現在のデッキをQRで共有">QR生成</button>
            <button id="btnQrFile" title="QR画像（スクショ等）からデッキを取り込む">画像QR読込</button>
            <input id="qrFileInput" type="file" accept="image/*" class="hidden" />
            <button id="btnBuildStart">このデッキで開始</button>
            <button id="btnBuildSolo" title="一人回し（2デッキ選択）">一人回し</button>
            <button id="btnBuildCancel">キャンセル</button>
            <div class="builderSep"></div>
            <button id="btnDeckSave" title="構築中のデッキを保存して一覧に登録">💾デッキセーブ</button>
            <button id="btnDeckLoad" title="保存済みデッキ一覧を開く">📚デッキロード</button>
            <button id="btnDeckDownload" title="保存済みデッキ一覧(セーブデータ)をJSONでダウンロード">⬇セーブDL</button>
            <label class="btnLike" title="ダウンロードしたセーブデータ(JSON)をアップロードして取り込む">⬆セーブUP<input id="deckUploadInput" type="file" accept="application/json,.json"></label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- deck QR -->
  <div id="qrModal" class="hidden">
    <div id="qrPanel" role="dialog" aria-modal="true" aria-label="デッキQR">
      <div class="qrHeader">
        <h2>デッキQR</h2>
        <button id="btnQrClose" type="button">閉じる</button>
      </div>
      <div class="qrBody">
        <canvas id="qrCanvas" width="320" height="320"></canvas>
        <img id="qrImg" width="320" height="320" alt="QR" style="display:none;" />
        <div class="qrHint">スマホで読み取ってデッキを取り込めます</div>
        <textarea id="qrText" readonly></textarea>
        <div class="qrBtns">
          <button id="btnQrCopy" type="button">コードをコピー</button>
        </div>
      </div>
    </div>
  </div>

  

  <!-- deck manager -->
  <div id="deckMgr" class="hidden">
    <div id="deckMgrPanel" role="dialog" aria-modal="true" aria-label="デッキ一覧">
      <div id="deckMgrHeader">
        <h2>デッキ一覧</h2>
        <div class="deckMgrRight">
          <input id="deckMgrSearch" type="text" placeholder="名前で検索" />
          <button id="btnDeckMgrClose">閉じる</button>
        </div>
      </div>
      <div id="deckMgrList"></div>
      <div id="deckMgrFooter">
        <div class="hint"><span id="deckMgrCount">0</span> 件</div>
        <button id="btnDeckMgrDownload" title="保存済みデッキ一覧(セーブデータ)をJSONでダウンロード">⬇一覧DL</button>
      </div>
    </div>
  </div>


  <!-- viewer -->
  <div id="viewer" class="hidden">
    <div id="viewerPanel">
      <h2 id="viewerTitle"></h2>
      <input id="viewerSearch" type="text" placeholder="名前でフィルタ...">
      <div id="viewerGrid"></div>
      <div id="viewerBtns">
        <button id="btnViewerSelectAll">全選択/解除</button>
        <button id="btnViewerCancel">キャンセル</button>
        <button id="btnViewerToDiscard" style="display:none;">選択→捨て札へ</button>
        <button id="btnViewerToHand">選択→手札へ</button>
      </div>
    </div>
  </div>

<!-- preview -->
  <div id="preview" class="hidden">
    <div id="previewPanel">
       <div id="previewLeft"><img id="previewImg" src="" alt="preview"></div>
       <div id="previewInfo" aria-label="カード情報"></div>
       <button id="previewClose">×</button>
     </div>
  </div>

  <!-- token selector -->
  <div id="token" class="hidden">
    <div id="tokenPanel">
      <h2>トークンを選択</h2>
      <div id="tokenGrid"></div>
      <div id="tokenFooter">
        <label>枚数 <input id="tokenCount" type="number" min="1" max="20" value="1"></label>
        <button id="btnTokenCancel">キャンセル</button>
        <button id="btnTokenCreate">生成</button>
      </div>
    </div>
  </div>


</div>

  <!-- counter selector -->
  <div id="counter" class="hidden" aria-label="カウンター選択">
    <div id="counterPanel">
      <h2>カウンターを選択</h2>
      <div id="counterHelp">選択中のカードに載せます。<b>C</b>で開く / <b>1〜4</b>で即適用</div>
      <div id="counterGrid"></div>
      <div id="counterFooter">
        <button id="btnCounterClear" type="button">カウンター消去</button>
        <button id="btnCounterCancel" type="button">閉じる</button>
      </div>
    </div>
  </div>

  
  <!-- stack / overlap manager -->
  <div id="stack" class="hidden">
    <div id="stackPanel">
      <h2 id="stackTitle">重なり</h2>
      <div id="stackHelp">上（手前）ほど盤面で上に表示されます。クリックで選択、ボタンで順番を変更できます。<br>束をまとめて移動：<b>「束を丸ごと移動」</b> か <b>Alt+ドラッグ</b></div>
      <div id="stackList"></div>
      <div id="stackFooter">
        <button id="btnStackMoveAll">束を丸ごと移動</button>
        <button id="btnStackClose">閉じる</button>
      </div>
    </div>
  </div>

  <div id="stackDropChooser" class="hidden">
    <div id="stackDropChooserPanel" role="dialog" aria-modal="true" aria-label="重ね位置を選択">
      <div id="stackDropChooserTitle">重ねる位置を選択</div>
      <div id="stackDropChooserHelp">このエリアには既にカードがあります。どこに重ねますか？</div>
      <div id="stackDropChooserBtns">
        <button id="btnStackDropBottom">一番下</button>
        <button id="btnStackDropSecondTop">上から2番目</button>
        <button id="btnStackDropTop">一番上</button>
      </div>
    </div>
  </div>

  <!-- reveal / deck top 공개 -->
  <div id="reveal" class="hidden">
    <div id="revealPanel">
      <h2 id="revealTitle">山札 公開</h2>
      <div id="revealHelp">上（山札の上）ほど先に引かれます。クリックで選択、▲▼で順番変更できます。</div>
      <div id="revealList"></div>
      <div id="revealFooter">
        <button id="btnRevealSelectAll">全選択/解除</button>
        <button id="btnRevealToHand">選択→手札へ</button>
        <button id="btnRevealToDiscard">選択→捨て札へ</button>
        <button id="btnRevealReturn">この順で山札上へ戻す</button>
        <button id="btnRevealCancel">キャンセル</button>
      </div>
    </div>
  </div>



  <!-- shortcuts list -->
  <div id="shortcuts" class="hidden">
    <div id="shortcutsPanel" role="dialog" aria-modal="true" aria-label="ショートカット一覧">
      <div id="shortcutsHeader">
        <h2>ショートカット一覧</h2>
        <button id="btnShortcutsClose" type="button">閉じる</button>
      </div>
      <div id="shortcutsBody">
        <div class="scSection">
          <h3>盤面操作（プレイモード）</h3>
          <table class="scTable">
            <tr><td class="scKey"><kbd>Shift</kbd> + クリック</td><td>複数選択 / 解除（トグル）</td></tr>
            <tr><td class="scKey">ドラッグ</td><td>選択カードを移動（複数選択中はまとめて移動）</td></tr>
            <tr><td class="scKey"><kbd>Alt</kbd> + ドラッグ</td><td>同じエリアに重なっている束をまとめて移動（手札/山札/捨て札以外）</td></tr>
            <tr><td class="scKey"><kbd>Alt</kbd> + ホイール</td><td>カードの拡大 / 縮小</td></tr>
            <tr><td class="scKey"><kbd>F</kbd></td><td>選択カードを表裏反転</td></tr>
            <tr><td class="scKey"><kbd>Delete</kbd></td><td>選択カードを消滅（完全削除）</td></tr>
            <tr><td class="scKey"><kbd>E</kbd></td><td>選択カードを最前面へ</td></tr>
            <tr><td class="scKey"><kbd>R</kbd></td><td>選択カードを最後面へ</td></tr>
                        <tr><td class="scKey"><kbd>C</kbd></td><td>カウンター選択（選択中のカードに載せる）</td></tr>
            <tr><td class="scKey"><kbd>1</kbd>〜<kbd>4</kbd></td><td>カウンター即適用（+1000 / +3000 / +5000 / +10000）</td></tr>
<tr><td class="scKey"><kbd>Space</kbd></td><td>拡大表示（選択中のカード）</td></tr>
            <tr><td class="scKey"><kbd>Esc</kbd></td><td>開いているパネルを閉じる（拡大/重なり/公開/トークン/この一覧 など）</td></tr>
          </table>
          <div class="scNote">※共有用（観戦）ウィンドウは手札/サーチ非表示のため、盤面操作ショートカットも無効です。</div>
        </div>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- calculator widget (toggle from toolbar) -->
  <div id="calcWidget" class="hidden" aria-label="計算機">
    <div id="calcHeader">
      <div class="title">🧮 計算機</div>
      <div class="btns">
        <button id="btnCalcClear" type="button" title="クリア">C</button>
        <button id="btnCalcClose" type="button" title="閉じる">✕</button>
      </div>
    </div>
    <div id="calcBody">
      <input id="calcInput" type="text" inputmode="decimal" autocomplete="off" placeholder="例: (1200+400)*2  /  12.5*3  /  2^10">
      <div id="calcRow">
        <button id="btnCalcEval" type="button">= 計算</button>
        <button id="btnCalcCopy" type="button">結果コピー</button>
        <button id="btnCalcBack" type="button">⌫</button>
      </div>
      <div id="calcResult"><div class="val">0</div><div class="hint">Enterで計算</div></div>
      <div id="calcErr" class="calcErr hidden"></div>
      <div id="calcHistory"></div>
    </div>
  </div>


<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
<script src="card_meta.js"></script>
<script src="app.js"></script>

  <!-- solo deck select modal -->
  <div id="soloDeckModal" class="hidden">
    <div id="soloDeckPanel" role="dialog" aria-modal="true" aria-label="一人回し デッキ選択">
      <div id="soloDeckHeader">
        <h2>一人回し：デッキ選択</h2>
        <button id="btnSoloClose" type="button" aria-label="閉じる">✕</button>
      </div>
      <div id="soloStepText">1/2：下側（自分）のデッキを選択</div>
      <input id="soloDeckSearch" type="text" placeholder="デッキ名で検索..." />
      <div id="soloDeckList"></div>
      <div id="soloDeckFooter">
        <div id="soloPickedInfo">未選択</div>
        <div class="btnRow">
          <button id="btnSoloBack" type="button" disabled>戻る</button>
          <button id="btnSoloStart" type="button" class="primary" disabled>開始</button>
        </div>
      </div>
    </div>
  </div>

  <!-- solo container -->
  <div id="soloContainer" class="hidden" aria-label="一人回しモード">
    <div id="soloTopBar">
      <div class="soloTitle">一人回しモード（▲上に相手盤面 / ▼下に自分盤面）</div>
      <button id="btnSoloExit" type="button">終了</button>
    </div>
    <div id="soloScroll">
      <div id="soloFrames">
        <iframe id="soloFrameOpp" title="相手盤面"></iframe>
        <iframe id="soloFrameYou" title="自分盤面"></iframe>
      </div>
    </div>
  </div>

</body>
</html>
